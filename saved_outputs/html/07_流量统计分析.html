<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能交通监控 - 流量统计分析</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --primary-color: #0071e3;
            --secondary-color: #2997ff;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --border-color: #d2d2d7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-primary);
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .title {
            font-size: 28px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .date-picker {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .date-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--card-color);
            color: var(--text-primary);
        }
        
        .btn {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            color: var(--primary-color);
        }
        
        .chart-container {
            width: 100%;
            height: 300px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .table-container {
            width: 100%;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background-color: #f8f8f8;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        tr:hover {
            background-color: #f8f8f8;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-high {
            background-color: #ff3b30;
            color: white;
        }
        
        .status-medium {
            background-color: #ff9500;
            color: white;
        }
        
        .status-low {
            background-color: #34c759;
            color: white;
        }
        
        .report-section {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-btn {
            padding: 8px 16px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            z-index: 1;
            right: 0;
        }
        
        .dropdown-content a {
            color: var(--text-primary);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        
        .dropdown-content a:hover {
            background-color: #f8f8f8;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .filter-section {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .select-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--card-color);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">流量统计分析</h1>
        <div class="date-picker">
            <input type="date" class="date-input" id="report-date" value="2024-06-15">
            <button class="btn" id="refresh-btn">刷新数据</button>
        </div>
    </div>
    
    <div class="filter-section">
        <select class="select-input" id="region-select">
            <option value="all">全部区域</option>
            <option value="north">北部区域</option>
            <option value="south">南部区域</option>
            <option value="east">东部区域</option>
            <option value="west">西部区域</option>
            <option value="center">中心城区</option>
        </select>
        
        <select class="select-input" id="road-type-select">
            <option value="all">全部道路类型</option>
            <option value="highway">高速公路</option>
            <option value="arterial">主干道</option>
            <option value="secondary">次干道</option>
            <option value="branch">支路</option>
        </select>
        
        <select class="select-input" id="time-range-select">
            <option value="24h">24小时</option>
            <option value="week">周数据</option>
            <option value="month">月数据</option>
        </select>
    </div>
    
    <div class="dashboard">
        <div class="card">
            <h2 class="card-title">时段流量分析</h2>
            <div class="chart-container" id="hourly-chart"></div>
        </div>
        
        <div class="card">
            <h2 class="card-title">周同比分析</h2>
            <div class="chart-container" id="weekly-chart"></div>
        </div>
        
        <div class="card full-width">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 class="card-title">拥堵路段排名</h2>
                <div class="dropdown">
                    <button class="dropdown-btn">
                        <span>排序方式</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                        </svg>
                    </button>
                    <div class="dropdown-content">
                        <a href="#" id="sort-by-congestion">拥堵指数</a>
                        <a href="#" id="sort-by-length">路段长度</a>
                        <a href="#" id="sort-by-avg-speed">平均速度</a>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>路段名称</th>
                            <th>区域</th>
                            <th>拥堵指数</th>
                            <th>平均速度</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="congestion-table">
                        <!-- 表格数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="report-section">
        <button class="btn" id="generate-report">生成分析报告</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化日期选择器
            const reportDate = document.getElementById('report-date');
            const refreshBtn = document.getElementById('refresh-btn');
            const regionSelect = document.getElementById('region-select');
            const roadTypeSelect = document.getElementById('road-type-select');
            const timeRangeSelect = document.getElementById('time-range-select');
            const generateReportBtn = document.getElementById('generate-report');
            
            // 设置默认日期为2024年6月15日
            reportDate.value = '2024-06-15';
            
            // 初始化图表
            const hourlyChart = echarts.init(document.getElementById('hourly-chart'));
            const weeklyChart = echarts.init(document.getElementById('weekly-chart'));
            
            // 渲染图表
            renderHourlyChart();
            renderWeeklyChart();
            renderCongestionTable();
            
            // 事件监听
            refreshBtn.addEventListener('click', function() {
                renderHourlyChart();
                renderWeeklyChart();
                renderCongestionTable();
            });
            
            regionSelect.addEventListener('change', function() {
                renderCongestionTable();
            });
            
            roadTypeSelect.addEventListener('change', function() {
                renderCongestionTable();
            });
            
            timeRangeSelect.addEventListener('change', function() {
                if (timeRangeSelect.value === '24h') {
                    renderHourlyChart();
                } else if (timeRangeSelect.value === 'week') {
                    renderWeeklyChart();
                } else {
                    renderMonthlyChart();
                }
            });
            
            generateReportBtn.addEventListener('click', function() {
                alert('分析报告生成中...完成后将自动下载PDF文件');
            });
            
            document.getElementById('sort-by-congestion').addEventListener('click', function(e) {
                e.preventDefault();
                renderCongestionTable('congestion');
            });
            
            document.getElementById('sort-by-length').addEventListener('click', function(e) {
                e.preventDefault();
                renderCongestionTable('length');
            });
            
            document.getElementById('sort-by-avg-speed').addEventListener('click', function(e) {
                e.preventDefault();
                renderCongestionTable('speed');
            });
            
            // 窗口大小变化时重新调整图表大小
            window.addEventListener('resize', function() {
                hourlyChart.resize();
                weeklyChart.resize();
            });
            
            // 24小时流量图表
            function renderHourlyChart() {
                const hours = [];
                const trafficData = [];
                const avgSpeedData = [];
                
                for (let i = 0; i < 24; i++) {
                    hours.push(i + ':00');
                    // 模拟早晚高峰数据
                    const baseTraffic = Math.floor(Math.random() * 500) + 300;
                    let traffic = baseTraffic;
                    
                    if (i >= 7 && i <= 9) {
                        traffic = baseTraffic * 1.8 + Math.floor(Math.random() * 300);
                    } else if (i >= 17 && i <= 19) {
                        traffic = baseTraffic * 1.6 + Math.floor(Math.random() * 200);
                    }
                    
                    trafficData.push(traffic);
                    
                    // 计算平均速度（与流量成反比）
                    let speed = 60 - (traffic / 1000 * 40);
                    if (speed < 10) speed = 10;
                    avgSpeedData.push(speed.toFixed(1));
                }
                
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['车流量', '平均速度(km/h)']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: hours,
                        axisLabel: {
                            interval: 3
                        }
                    },
                    yAxis: [
                        {
                            type: 'value',
                            name: '车流量',
                            min: 0,
                            max: 1500,
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: '平均速度',
                            min: 0,
                            max: 80,
                            axisLabel: {
                                formatter: '{value} km/h'
                            }
                        }
                    ],
                    series: [
                        {
                            name: '车流量',
                            type: 'line',
                            smooth: true,
                            data: trafficData,
                            lineStyle: {
                                width: 3,
                                color: '#0071e3'
                            },
                            itemStyle: {
                                color: '#0071e3'
                            },
                            areaStyle: {
                                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                    {
                                        offset: 0,
                                        color: 'rgba(0, 113, 227, 0.3)'
                                    },
                                    {
                                        offset: 1,
                                        color: 'rgba(0, 113, 227, 0.1)'
                                    }
                                ])
                            }
                        },
                        {
                            name: '平均速度',
                            type: 'line',
                            yAxisIndex: 1,
                            smooth: true,
                            data: avgSpeedData,
                            lineStyle: {
                                width: 3,
                                color: '#34c759'
                            },
                            itemStyle: {
                                color: '#34c759'
                            }
                        }
                    ]
                };
                
                hourlyChart.setOption(option);
            }
            
            // 周同比分析图表
            function renderWeeklyChart() {
                const days = ['周一', '周二', '周三', '周四', '周五', '周六', '周日'];
                const currentWeek = [];
                const lastWeek = [];
                const yoy = [];
                
                for (let i = 0; i < 7; i++) {
                    const base = Math.floor(Math.random() * 400) + 600;
                    currentWeek.push(base);
                    lastWeek.push(Math.floor(base * (0.9 + Math.random() * 0.2)));
                    yoy.push(((currentWeek[i] - lastWeek[i]) / lastWeek[i] * 100).toFixed(1));
                }
                
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: function(params) {
                            let result = params[0].name + '<br/>';
                            params.forEach(function(item) {
                                if (item.seriesName === '同比变化') {
                                    result += item.marker + ' ' + item.seriesName + ': ' + item.value + '%<br/>';
                                } else {
                                    result += item.marker + ' ' + item.seriesName + ': ' + item.value + '辆<br/>';
                                }
                            });
                            return result;
                        }
                    },
                    legend: {
                        data: ['本周流量', '上周流量', '同比变化']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: days
                    },
                    yAxis: [
                        {
                            type: 'value',
                            name: '车流量',
                            min: 0,
                            max: 1200,
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: '同比变化',
                            min: -20,
                            max: 20,
                            axisLabel: {
                                formatter: '{value}%'
                            }
                        }
                    ],
                    series: [
                        {
                            name: '本周流量',
                            type: 'bar',
                            barWidth: '30%',
                            data: currentWeek,
                            itemStyle: {
                                color: '#0071e3'
                            }
                        },
                        {
                            name: '上周流量',
                            type: 'bar',
                            barWidth: '30%',
                            data: lastWeek,
                            itemStyle: {
                                color: '#86868b'
                            }
                        },
                        {
                            name: '同比变化',
                            type: 'line',
                            yAxisIndex: 1,
                            data: yoy,
                            symbol: 'circle',
                            symbolSize: 8,
                            lineStyle: {
                                width: 3,
                                color: '#ff9500'
                            },
                            itemStyle: {
                                color: '#ff9500'
                            }
                        }
                    ]
                };
                
                weeklyChart.setOption(option);
            }
            
            // 拥堵路段表格
            function renderCongestionTable(sortBy = 'congestion') {
                const region = document.getElementById('region-select').value;
                const roadType = document.getElementById('road-type-select').value;
                
                // 模拟数据
                const roads = [
                    { name: '中山路(人民广场段)', region: 'center', type: 'arterial', congestion: 8.7, length: 2.3, speed: 12.5 },
                    { name: '环城高速(北段)', region: 'north', type: 'highway', congestion: 7.9, length: 5.8, speed: 35.2 },
                    { name: '解放大道(火车站段)', region: 'center', type: 'arterial', congestion: 7.5, length: 1.8, speed: 15.8 },
                    { name: '滨海路(东段)', region: 'east', type: 'arterial', congestion: 6.8, length: 3.2, speed: 22.4 },
                    { name: '学院路(大学城段)', region: 'south', type: 'secondary', congestion: 6.5, length: 1.5, speed: 18.6 },
                    { name: '工业大道(开发区段)', region: 'west', type: 'arterial', congestion: 6.2, length: 2.7, speed: 25.3 },
                    { name: '长江路(商业中心段)', region: 'center', type: 'arterial', congestion: 5.9, length: 1.2, speed: 20.1 },
                    { name: '西湖路(景区段)', region: 'south', type: 'secondary', congestion: 5.7, length: 2.1, speed: 15.4 },
                    { name: '光明路(住宅区段)', region: 'north', type: 'branch', congestion: 5.3, length: 0.8, speed: 18.9 },
                    { name: '创业路(科技园段)', region: 'east', type: 'secondary', congestion: 5.1, length: 1.6, speed: 24.7 }
                ];
                
                // 过滤数据
                let filteredRoads = roads.filter(road => {
                    let match = true;
                    if (region !== 'all' && road.region !== region) match = false;
                    if (roadType !== 'all' && road.type !== roadType) match = false;
                    return match;
                });
                
                // 排序
                if (sortBy === 'length') {
                    filteredRoads.sort((a, b) => b.length - a.length);
                } else if (sortBy === 'speed') {
                    filteredRoads.sort((a, b) => a.speed - b.speed);
                } else {
                    filteredRoads.sort((a, b) => b.congestion - a.congestion);
                }
                
                // 渲染表格
                const tableBody = document.getElementById('congestion-table');
                tableBody.innerHTML = '';
                
                filteredRoads.forEach((road, index) => {
                    const row = document.createElement('tr');
                    
                    // 确定拥堵状态
                    let statusClass = 'status-low';
                    let statusText = '畅通';
                    if (road.congestion >= 7) {
                        statusClass = 'status-high';
                        statusText = '严重拥堵';
                    } else if (road.congestion >= 5) {
                        statusClass = 'status-medium';
                        statusText = '拥堵';
                    }
                    
                    // 区域名称映射
                    const regionNames = {
                        'north': '北部',
                        'south': '南部',
                        'east': '东部',
                        'west': '西部',
                        'center': '中心'
                    };
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${road.name}</td>
                        <td>${regionNames[road.region]}</td>
                        <td>${road.congestion.toFixed(1)}</td>
                        <td>${road.speed.toFixed(1)} km/h</td>
                        <td><span class="status ${statusClass}">${statusText}</span></td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
        });
    </script>
</body>
</html>